<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Day 20 - reqwest | 24 days of Rust</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../../book/vol2/day21.html" />
    
    
    <link rel="prev" href="../../book/vol2/day19.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="2.20"
        data-chapter-title="Day 20 - reqwest"
        data-filepath="book/vol2/day20.md"
        data-basepath="../.."
        data-revision="Thu May 04 2017 11:53:07 GMT+0000 (UTC)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="book/vol1/index.html">
            
                
                    <a href="../../book/vol1/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Volume 1
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="book/vol1/day1.html">
            
                
                    <a href="../../book/vol1/day1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Day 1 - Cargo and crates.io
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="book/vol1/day2.html">
            
                
                    <a href="../../book/vol1/day2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Day 2 - primal
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="book/vol1/day3.html">
            
                
                    <a href="../../book/vol1/day3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Day 3 - csv
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="book/vol1/day4.html">
            
                
                    <a href="../../book/vol1/day4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Day 4 - docopt
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="book/vol1/day5.html">
            
                
                    <a href="../../book/vol1/day5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Day 5 - hyper
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="book/vol1/day6.html">
            
                
                    <a href="../../book/vol1/day6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        Day 6 - working with JSON
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="book/vol1/day7.html">
            
                
                    <a href="../../book/vol1/day7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                        Day 7 - itertools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="book/vol1/day8.html">
            
                
                    <a href="../../book/vol1/day8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.8.</b>
                        
                        Day 8 - racer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="book/vol1/day9.html">
            
                
                    <a href="../../book/vol1/day9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.9.</b>
                        
                        Day 9 - anymap
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="book/vol1/day10.html">
            
                
                    <a href="../../book/vol1/day10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.10.</b>
                        
                        Day 10 - the glorious tau
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="book/vol1/day11.html">
            
                
                    <a href="../../book/vol1/day11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.11.</b>
                        
                        Day 11 - postgres
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="book/vol1/day12.html">
            
                
                    <a href="../../book/vol1/day12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.12.</b>
                        
                        Day 12 - image
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="book/vol1/day13.html">
            
                
                    <a href="../../book/vol1/day13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.13.</b>
                        
                        Day 13 - uuid
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="book/vol1/day14.html">
            
                
                    <a href="../../book/vol1/day14.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.14.</b>
                        
                        Day 14 - nalgebra
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="book/vol1/day15.html">
            
                
                    <a href="../../book/vol1/day15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.15.</b>
                        
                        Day 15 - FUSE filesystems, part 1
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="book/vol1/day16.html">
            
                
                    <a href="../../book/vol1/day16.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.16.</b>
                        
                        Day 16 - FUSE filesystems, part 2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="book/vol1/day17.html">
            
                
                    <a href="../../book/vol1/day17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.17.</b>
                        
                        Day 17 - from_fn
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="book/vol1/day18.html">
            
                
                    <a href="../../book/vol1/day18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.18.</b>
                        
                        Day 18 - redis
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="book/vol1/day19.html">
            
                
                    <a href="../../book/vol1/day19.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.19.</b>
                        
                        Day 19 - rusti
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="book/vol1/day20.html">
            
                
                    <a href="../../book/vol1/day20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.20.</b>
                        
                        Day 20 - zeromq
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="book/vol1/day21.html">
            
                
                    <a href="../../book/vol1/day21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.21.</b>
                        
                        Day 21 - rust-crypto
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="book/vol1/day22.html">
            
                
                    <a href="../../book/vol1/day22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.22.</b>
                        
                        Day 22 - built with Rust
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="book/vol1/day23.html">
            
                
                    <a href="../../book/vol1/day23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.23.</b>
                        
                        Day 23 - calling Rust from other languages
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="book/vol1/day24.html">
            
                
                    <a href="../../book/vol1/day24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.24.</b>
                        
                        Day 24 - conclusion
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="book/vol2/index.html">
            
                
                    <a href="../../book/vol2/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Volume 2
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="book/vol2/day1.html">
            
                
                    <a href="../../book/vol2/day1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Day 1 - cargo subcommands
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="book/vol2/day2.html">
            
                
                    <a href="../../book/vol2/day2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Day 2 - hound
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="book/vol2/day3.html">
            
                
                    <a href="../../book/vol2/day3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Day 3 - rayon
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="book/vol2/day4.html">
            
                
                    <a href="../../book/vol2/day4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Day 4 - structured logging
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="book/vol2/day5.html">
            
                
                    <a href="../../book/vol2/day5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        Day 5 - environment variables
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="book/vol2/day6.html">
            
                
                    <a href="../../book/vol2/day6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Day 6 - derive_builder
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="book/vol2/day7.html">
            
                
                    <a href="../../book/vol2/day7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        Day 7 - static initialization
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="book/vol2/day8.html">
            
                
                    <a href="../../book/vol2/day8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                        Day 8 - serde
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="book/vol2/day9.html">
            
                
                    <a href="../../book/vol2/day9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.9.</b>
                        
                        Day 9 - winreg
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="book/vol2/day10.html">
            
                
                    <a href="../../book/vol2/day10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.10.</b>
                        
                        Day 10 - nom, part 1
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="book/vol2/day11.html">
            
                
                    <a href="../../book/vol2/day11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.11.</b>
                        
                        Day 11 - nom, part 2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.12" data-path="book/vol2/day12.html">
            
                
                    <a href="../../book/vol2/day12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.12.</b>
                        
                        Day 12 - clap
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.13" data-path="book/vol2/day13.html">
            
                
                    <a href="../../book/vol2/day13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.13.</b>
                        
                        Day 13 - zip and lzma compression
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.14" data-path="book/vol2/day14.html">
            
                
                    <a href="../../book/vol2/day14.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.14.</b>
                        
                        Day 14 - Cursive
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.15" data-path="book/vol2/day15.html">
            
                
                    <a href="../../book/vol2/day15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.15.</b>
                        
                        Day 15 - tera
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.16" data-path="book/vol2/day16.html">
            
                
                    <a href="../../book/vol2/day16.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.16.</b>
                        
                        Day 16 - git2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.17" data-path="book/vol2/day17.html">
            
                
                    <a href="../../book/vol2/day17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.17.</b>
                        
                        Day 17 - diesel
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.18" data-path="book/vol2/day18.html">
            
                
                    <a href="../../book/vol2/day18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.18.</b>
                        
                        Day 18 - error_chain
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.19" data-path="book/vol2/day19.html">
            
                
                    <a href="../../book/vol2/day19.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.19.</b>
                        
                        Day 19 - leftpad
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="2.20" data-path="book/vol2/day20.html">
            
                
                    <a href="../../book/vol2/day20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.20.</b>
                        
                        Day 20 - reqwest
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.21" data-path="book/vol2/day21.html">
            
                
                    <a href="../../book/vol2/day21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.21.</b>
                        
                        Day 21 - app_dirs and preferences
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.22" data-path="book/vol2/day22.html">
            
                
                    <a href="../../book/vol2/day22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.22.</b>
                        
                        Day 22 - lettre
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.23" data-path="book/vol2/day23.html">
            
                
                    <a href="../../book/vol2/day23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.23.</b>
                        
                        Day 23 - built with Rust
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.24" data-path="book/vol2/day24.html">
            
                
                    <a href="../../book/vol2/day24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.24.</b>
                        
                        Day 24 - conclusion
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >24 days of Rust</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="day-20--reqwest">Day 20 - reqwest</h1>
<p>In the first volume of 24 Days of Rust, I&apos;ve
<a href="https://zsiciarz.github.io/24daysofrust/book/vol1/day5.html" target="_blank">written about hyper</a>
as the Rust HTTP toolkit. A lot of things have changed in the last two years,
but <a href="http://hyper.rs/" target="_blank">hyper</a> is still the best solution for HTTP in Rust.
However, <code>hyper</code> is undergoing some major changes to use
<a href="https://github.com/tokio-rs/tokio" target="_blank"><code>tokio</code></a> for async I/O. While this
will be fantastic for use cases where performance is top priority,
it will also make <code>hyper</code> APIs a bit more complex. It&apos;s good to know about
event loops, futures and services, but sometimes we just want to send a GET
request and call it a day.</p>
<p>Sean McArthur created <a href="https://crates.io/crates/reqwest/" target="_blank">Reqwest</a> specifically
for such scenarios. It is a high level HTTP client built on top of <code>hyper</code>.
The situation here is somewhat similar to Python, where
<a href="http://docs.python-requests.org/en/master/" target="_blank">requests</a> provides a
simple API on top of heavy <code>urllib3</code> machinery. <code>Reqwest</code> is relatively new
compared to <code>requests</code>, but it has the same goal - to make simple HTTP requests
easy and delegate complex tasks to <code>hyper</code>.</p>
<p><code>Reqwest</code> also uses OS-provided TLS support if possible. This avoids a lot of
pain setting up OpenSSL on Windows.</p>
<h2 id="our-first-request">Our first request</h2>
<p>The simplest example is just a <em>fire-and-forget</em> call to <code>reqwest::get()</code>.</p>
<pre><code class="lang-rust"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> reqwest;

<span class="hljs-keyword">use</span> std::io::Read;

<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> response = reqwest::get(<span class="hljs-string">&quot;https://httpbin.org/status/418&quot;</span>)
    .expect(<span class="hljs-string">&quot;Failed to send request&quot;</span>);
<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, response.status());
<span class="hljs-keyword">for</span> header <span class="hljs-keyword">in</span> response.headers().iter() {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}: {}&quot;</span>, header.name(), header.value_string());
}
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buf = String::new();
response.read_to_string(&amp;<span class="hljs-keyword">mut</span> buf).expect(<span class="hljs-string">&quot;Failed to read response&quot;</span>);
<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, buf);
</code></pre>
<p>We can inspect status code and headers of the response as shown above.
<code>Response</code> implements the standard <code>std::io::Read</code> trait, so we can read it
into a string or a byte buffer.</p>
<pre><code class="lang-text">418 I&apos;m a teapot
Server: nginx
Date: Tue, 20 Dec 2016 17:30:26 GMT
Content-Length: 135
Connection: keep-alive
Access-Control-Allow-Origin: *
x-more-info: http://tools.ietf.org/html/rfc2324
Access-Control-Allow-Credentials: true

    -=[ teapot ]=-

       _...._
     .&apos;  _ _ `.
    | .&quot;` ^ `&quot;. _,
    \_;`&quot;---&quot;`|//
      |       ;/
      \_     _/
        `&quot;&quot;&quot;`
</code></pre>
<p>Aside: I&apos;ve just recently discovered the
<a href="https://doc.rust-lang.org/std/io/fn.copy.html" target="_blank"><code>std::io::copy</code></a> function.
It takes two values - one <code>Read</code> and the other <code>Write</code> - and streams bytes
from the reader to the writer. So if we wanted to just print the response
to standard output, we can do it like this:</p>
<pre><code class="lang-rust"><span class="hljs-keyword">use</span> std::io::copy;

copy(&amp;<span class="hljs-keyword">mut</span> response, &amp;<span class="hljs-keyword">mut</span> stdout()).expect(<span class="hljs-string">&quot;Failed to read response&quot;</span>);
</code></pre>
<h2 id="using-a-client-to-postput-data">Using a Client to POST/PUT data</h2>
<p>With <code>hyper</code> we have to be rather verbose when it comes to POST-ing data.
We need to manually serialize/urlencode key/value pairs before actually
stuffing them in the request body. <code>reqwest</code> handles that automatically
for us. But while <code>get()</code> was a nice shortcut, most of the time we&apos;ll be
working with a <code>Client</code>.</p>
<pre><code class="lang-rust"><span class="hljs-keyword">use</span> std::collections::HashMap;

<span class="hljs-keyword">let</span> client = reqwest::Client::new().expect(<span class="hljs-string">&quot;Couldn&apos;t create client&quot;</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> params = HashMap::new();
params.insert(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;Sir Lancelot&quot;</span>);
params.insert(<span class="hljs-string">&quot;quest&quot;</span>, <span class="hljs-string">&quot;to seek the Holy Grail&quot;</span>);
params.insert(<span class="hljs-string">&quot;favorite_colour&quot;</span>, <span class="hljs-string">&quot;blue&quot;</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> response = client.post(<span class="hljs-string">&quot;https://httpbin.org/post&quot;</span>)
    .form(&amp;params)
    .send()
    .expect(<span class="hljs-string">&quot;Failed to send request&quot;</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buf = String::new();
response.read_to_string(&amp;<span class="hljs-keyword">mut</span> buf).expect(<span class="hljs-string">&quot;Failed to read response&quot;</span>);
<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, buf);
</code></pre>
<p>All request methods of a <code>Client</code> do not return a response just yet.
The return value is a
<a href="https://docs.rs/reqwest/0.2.0/reqwest/struct.RequestBuilder.html" target="_blank"><code>RequestBuilder</code></a>,
which allows to add payload, headers etc. before actually sending the request
with <code>send()</code>.</p>
<pre><code class="lang-text">{
  &quot;args&quot;: {},
  &quot;data&quot;: &quot;&quot;,
  &quot;files&quot;: {},
  &quot;form&quot;: {
    &quot;favorite_colour&quot;: &quot;blue&quot;,
    &quot;name&quot;: &quot;Sir Lancelot&quot;,
    &quot;quest&quot;: &quot;to seek the Holy Grail&quot;
  },
  // ...
}
</code></pre>
<p>We can submit the same payload (the <code>HashMap</code>) as a JSON-encoded request
body. And while we&apos;re at it, let&apos;s change the HTTP method to PUT.</p>
<pre><code class="lang-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> response = client.request(reqwest::Method::Put, <span class="hljs-string">&quot;https://httpbin.org/put&quot;</span>)
    .json(&amp;params)
    .send()
    .expect(<span class="hljs-string">&quot;Failed to send request&quot;</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buf = String::new();
response.read_to_string(&amp;<span class="hljs-keyword">mut</span> buf).expect(<span class="hljs-string">&quot;Failed to read response&quot;</span>);
<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, buf);
</code></pre>
<p>There&apos;s no shortcut method for PUT, but <code>request()</code> takes the <code>Method</code> enum
variant as its first argument. The <code>RequestBuilder::json()</code> method serializes
its argument to JSON and sets that as request&apos;s body.</p>
<pre><code class="lang-text">{
  &quot;args&quot;: {},
  &quot;data&quot;: &quot;{\&quot;name\&quot;:\&quot;Sir Lancelot\&quot;,\&quot;quest\&quot;:\&quot;to seek the Holy Grail\&quot;,\&quot;favorite_colour\&quot;:\&quot;blue\&quot;}&quot;,
  &quot;files&quot;: {},
  &quot;form&quot;: {},
  // ...
  &quot;json&quot;: {
    &quot;favorite_colour&quot;: &quot;blue&quot;,
    &quot;name&quot;: &quot;Sir Lancelot&quot;,
    &quot;quest&quot;: &quot;to seek the Holy Grail&quot;
  },
  // ...
}
</code></pre>
<h2 id="basic-authentication">Basic Authentication</h2>
<p><code>reqwest</code> re-exports the entire <code>hyper::headers</code> module as part of its
public API. This means we can use the strongly-typed headers from <code>hyper</code>
directly in our requests. For example if we wanted to access a page protected
by HTTP Basic Auth, we can do it as follows:</p>
<pre><code class="lang-rust"><span class="hljs-keyword">use</span> reqwest::header::{Authorization, Basic};

<span class="hljs-keyword">let</span> response = client.get(<span class="hljs-string">&quot;https://httpbin.org/basic-auth/user/passwd&quot;</span>)
    .send()
    .expect(<span class="hljs-string">&quot;Failed to send request&quot;</span>);
<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, response.status());

<span class="hljs-keyword">let</span> credentials = Basic {
    username: <span class="hljs-string">&quot;user&quot;</span>.to_string(),
    password: <span class="hljs-built_in">Some</span>(<span class="hljs-string">&quot;passwd&quot;</span>.to_string()),
};
<span class="hljs-keyword">let</span> response = client.get(<span class="hljs-string">&quot;https://httpbin.org/basic-auth/user/passwd&quot;</span>)
    .header(Authorization(credentials))
    .send()
    .expect(<span class="hljs-string">&quot;Failed to send request&quot;</span>);
<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, response.status());
</code></pre>
<p>And what are the responses in both cases?</p>
<pre><code class="lang-text">401 Unauthorized
200 OK
</code></pre>
<h2 id="decoding-a-json-response">Decoding a JSON response</h2>
<p>Not only can we send JSON as the request body, we can deserialize the response
as well. Let&apos;s use the free and open <a href="http://pokeapi.co/" target="_blank">Pok&#xE9;api</a> to learn
more about creatures from a mildly popular game franchise.</p>
<pre><code class="lang-rust"><span class="hljs-preprocessor">#[macro_use]</span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> serde_derive;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> serde_json;

<span class="hljs-preprocessor">#[derive(Debug, Deserialize)]</span>
<span class="hljs-keyword">struct</span> Move {
    name: <span class="hljs-built_in">String</span>,
}

<span class="hljs-preprocessor">#[derive(Debug, Deserialize)]</span>
<span class="hljs-keyword">struct</span> PokemonMove {
    <span class="hljs-preprocessor">#[serde(rename=&quot;move&quot;)]</span>
    move_: Move,
}

<span class="hljs-preprocessor">#[derive(Debug, Deserialize)]</span>
<span class="hljs-keyword">struct</span> Pokemon {
    id: <span class="hljs-keyword">i32</span>,
    name: <span class="hljs-built_in">String</span>,
    height: <span class="hljs-keyword">i32</span>,
    weight: <span class="hljs-keyword">i32</span>,
    moves: <span class="hljs-built_in">Vec</span>&lt;PokemonMove&gt;,
}

<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> response = client.get(<span class="hljs-string">&quot;http://pokeapi.co/api/v2/pokemon/111&quot;</span>)
    .send()
    .expect(<span class="hljs-string">&quot;Failed to send request&quot;</span>);
<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-built_in">Ok</span>(pokemon) = response.json::&lt;Pokemon&gt;() {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{:#?}&quot;</span>, pokemon);
}
</code></pre>
<p>Responses from <code>reqwest</code> have a <code>json()</code> convenience method, which tries to
deserialize the content from JSON into a Rust struct. Note that we had to
rename the <code>move</code> field as it is a keyword in Rust. The responses from Pok&#xE9;api
contain a lot more data, but that&apos;s ok with <code>serde</code>. Excessive JSON fields
will be ignored until we add them to the struct.</p>
<pre><code class="lang-text">$ cargo run
Pokemon {
    id: 111,
    name: &quot;rhyhorn&quot;,
    height: 10,
    weight: 1150,
    moves: [
        PokemonMove {
            move_: Move {
                name: &quot;swords-dance&quot;
            }
        },
        PokemonMove {
            move_: Move {
                name: &quot;stomp&quot;
            }
        },
        // and a whole lot more...
    ]
}
</code></pre>
<h2 id="further-reading">Further reading</h2>
<ul>
<li><a href="http://seanmonstar.com/post/153221119046/introducing-reqwest" target="_blank">Introducing Reqwest</a></li>
<li><a href="https://www.reddit.com/r/rust/comments/51ehop/tokio_branch_of_hyper/" target="_blank">reddit thread</a> about a Tokio branch of hyper</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../book/vol2/day19.html" class="navigation navigation-prev " aria-label="Previous page: Day 19 - leftpad"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../book/vol2/day21.html" class="navigation navigation-next " aria-label="Next page: Day 21 - app_dirs and preferences"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

    
    <script src="../../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"include-codeblock":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
