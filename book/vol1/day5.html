<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Day 5 - hyper | 24 days of Rust</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../../book/vol1/day6.html" />
    
    
    <link rel="prev" href="../../book/vol1/day4.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="1.5"
        data-chapter-title="Day 5 - hyper"
        data-filepath="book/vol1/day5.md"
        data-basepath="../.."
        data-revision="Thu May 04 2017 11:53:07 GMT+0000 (UTC)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="book/vol1/index.html">
            
                
                    <a href="../../book/vol1/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Volume 1
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="book/vol1/day1.html">
            
                
                    <a href="../../book/vol1/day1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Day 1 - Cargo and crates.io
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="book/vol1/day2.html">
            
                
                    <a href="../../book/vol1/day2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Day 2 - primal
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="book/vol1/day3.html">
            
                
                    <a href="../../book/vol1/day3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Day 3 - csv
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="book/vol1/day4.html">
            
                
                    <a href="../../book/vol1/day4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Day 4 - docopt
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="book/vol1/day5.html">
            
                
                    <a href="../../book/vol1/day5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Day 5 - hyper
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="book/vol1/day6.html">
            
                
                    <a href="../../book/vol1/day6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        Day 6 - working with JSON
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="book/vol1/day7.html">
            
                
                    <a href="../../book/vol1/day7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                        Day 7 - itertools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="book/vol1/day8.html">
            
                
                    <a href="../../book/vol1/day8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.8.</b>
                        
                        Day 8 - racer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="book/vol1/day9.html">
            
                
                    <a href="../../book/vol1/day9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.9.</b>
                        
                        Day 9 - anymap
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="book/vol1/day10.html">
            
                
                    <a href="../../book/vol1/day10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.10.</b>
                        
                        Day 10 - the glorious tau
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="book/vol1/day11.html">
            
                
                    <a href="../../book/vol1/day11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.11.</b>
                        
                        Day 11 - postgres
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="book/vol1/day12.html">
            
                
                    <a href="../../book/vol1/day12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.12.</b>
                        
                        Day 12 - image
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="book/vol1/day13.html">
            
                
                    <a href="../../book/vol1/day13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.13.</b>
                        
                        Day 13 - uuid
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="book/vol1/day14.html">
            
                
                    <a href="../../book/vol1/day14.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.14.</b>
                        
                        Day 14 - nalgebra
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="book/vol1/day15.html">
            
                
                    <a href="../../book/vol1/day15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.15.</b>
                        
                        Day 15 - FUSE filesystems, part 1
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="book/vol1/day16.html">
            
                
                    <a href="../../book/vol1/day16.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.16.</b>
                        
                        Day 16 - FUSE filesystems, part 2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="book/vol1/day17.html">
            
                
                    <a href="../../book/vol1/day17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.17.</b>
                        
                        Day 17 - from_fn
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="book/vol1/day18.html">
            
                
                    <a href="../../book/vol1/day18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.18.</b>
                        
                        Day 18 - redis
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="book/vol1/day19.html">
            
                
                    <a href="../../book/vol1/day19.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.19.</b>
                        
                        Day 19 - rusti
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="book/vol1/day20.html">
            
                
                    <a href="../../book/vol1/day20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.20.</b>
                        
                        Day 20 - zeromq
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="book/vol1/day21.html">
            
                
                    <a href="../../book/vol1/day21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.21.</b>
                        
                        Day 21 - rust-crypto
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="book/vol1/day22.html">
            
                
                    <a href="../../book/vol1/day22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.22.</b>
                        
                        Day 22 - built with Rust
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="book/vol1/day23.html">
            
                
                    <a href="../../book/vol1/day23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.23.</b>
                        
                        Day 23 - calling Rust from other languages
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="book/vol1/day24.html">
            
                
                    <a href="../../book/vol1/day24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.24.</b>
                        
                        Day 24 - conclusion
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="book/vol2/index.html">
            
                
                    <a href="../../book/vol2/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Volume 2
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="book/vol2/day1.html">
            
                
                    <a href="../../book/vol2/day1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Day 1 - cargo subcommands
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="book/vol2/day2.html">
            
                
                    <a href="../../book/vol2/day2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Day 2 - hound
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="book/vol2/day3.html">
            
                
                    <a href="../../book/vol2/day3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Day 3 - rayon
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="book/vol2/day4.html">
            
                
                    <a href="../../book/vol2/day4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Day 4 - structured logging
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="book/vol2/day5.html">
            
                
                    <a href="../../book/vol2/day5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        Day 5 - environment variables
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="book/vol2/day6.html">
            
                
                    <a href="../../book/vol2/day6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Day 6 - derive_builder
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="book/vol2/day7.html">
            
                
                    <a href="../../book/vol2/day7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        Day 7 - static initialization
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="book/vol2/day8.html">
            
                
                    <a href="../../book/vol2/day8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                        Day 8 - serde
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="book/vol2/day9.html">
            
                
                    <a href="../../book/vol2/day9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.9.</b>
                        
                        Day 9 - winreg
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="book/vol2/day10.html">
            
                
                    <a href="../../book/vol2/day10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.10.</b>
                        
                        Day 10 - nom, part 1
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="book/vol2/day11.html">
            
                
                    <a href="../../book/vol2/day11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.11.</b>
                        
                        Day 11 - nom, part 2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.12" data-path="book/vol2/day12.html">
            
                
                    <a href="../../book/vol2/day12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.12.</b>
                        
                        Day 12 - clap
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.13" data-path="book/vol2/day13.html">
            
                
                    <a href="../../book/vol2/day13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.13.</b>
                        
                        Day 13 - zip and lzma compression
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.14" data-path="book/vol2/day14.html">
            
                
                    <a href="../../book/vol2/day14.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.14.</b>
                        
                        Day 14 - Cursive
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.15" data-path="book/vol2/day15.html">
            
                
                    <a href="../../book/vol2/day15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.15.</b>
                        
                        Day 15 - tera
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.16" data-path="book/vol2/day16.html">
            
                
                    <a href="../../book/vol2/day16.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.16.</b>
                        
                        Day 16 - git2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.17" data-path="book/vol2/day17.html">
            
                
                    <a href="../../book/vol2/day17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.17.</b>
                        
                        Day 17 - diesel
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.18" data-path="book/vol2/day18.html">
            
                
                    <a href="../../book/vol2/day18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.18.</b>
                        
                        Day 18 - error_chain
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.19" data-path="book/vol2/day19.html">
            
                
                    <a href="../../book/vol2/day19.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.19.</b>
                        
                        Day 19 - leftpad
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.20" data-path="book/vol2/day20.html">
            
                
                    <a href="../../book/vol2/day20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.20.</b>
                        
                        Day 20 - reqwest
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.21" data-path="book/vol2/day21.html">
            
                
                    <a href="../../book/vol2/day21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.21.</b>
                        
                        Day 21 - app_dirs and preferences
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.22" data-path="book/vol2/day22.html">
            
                
                    <a href="../../book/vol2/day22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.22.</b>
                        
                        Day 22 - lettre
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.23" data-path="book/vol2/day23.html">
            
                
                    <a href="../../book/vol2/day23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.23.</b>
                        
                        Day 23 - built with Rust
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.24" data-path="book/vol2/day24.html">
            
                
                    <a href="../../book/vol2/day24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.24.</b>
                        
                        Day 24 - conclusion
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >24 days of Rust</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="day-5--hyper">Day 5 - hyper</h1>
<blockquote>
<p>Relevancy: 1.9 stable</p>
</blockquote>
<p>The state of HTTP libraries in Rust was a constant flux before 1.0. However it appears that a specific package won the hearts of Rust programmers: <a href="https://crates.io/crates/hyper" target="_blank">hyper</a>, which will be the subject of this chapter.</p>
<p>I&apos;m going to focus on using <code>hyper</code> only as a client, although the library contains also a server implementation. However with the advance of Rust web frameworks building on top of HTTP libraries, the programmers will focus less on developing servers and more on the clients. Consuming web APIs is a lot more common than writing new shiny servers. How can <code>hyper</code> help us?</p>
<h2 id="basic-requests">Basic requests</h2>
<p>Let&apos;s start from the usual dependency definition in <code>Cargo.toml</code>.</p>
<pre><code class="lang-ini"><span class="hljs-title">[dependencies]</span>
<span class="hljs-setting">hyper = <span class="hljs-value"><span class="hljs-string">&quot;~0.7&quot;</span></span></span>
</code></pre>
<p>When you run <code>cargo build</code>, Cargo will download a few other required crates (for URL handling, mimetype support, OpenSSL bindings etc.) and hopefully compile <code>hyper</code> afterwards. Time for our first request!</p>
<pre><code class="lang-rust"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> hyper;

<span class="hljs-keyword">use</span> std::io::Read;
<span class="hljs-keyword">use</span> hyper::{Client};

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
    <span class="hljs-keyword">let</span> client = Client::new();
    <span class="hljs-keyword">let</span> url = <span class="hljs-string">&quot;http://httpbin.org/status/201&quot;</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> response = <span class="hljs-keyword">match</span> client.get(url).send() {
        <span class="hljs-built_in">Ok</span>(response) =&gt; response,
        <span class="hljs-built_in">Err</span>(_) =&gt; <span class="hljs-built_in">panic!</span>(<span class="hljs-string">&quot;Whoops.&quot;</span>),
    };
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buf = String::new();
    <span class="hljs-keyword">match</span> response.read_to_string(&amp;<span class="hljs-keyword">mut</span> buf) {
        <span class="hljs-built_in">Ok</span>(_) =&gt; (),
        <span class="hljs-built_in">Err</span>(_) =&gt; <span class="hljs-built_in">panic!</span>(<span class="hljs-string">&quot;I give up.&quot;</span>),
    };
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;buf: {}&quot;</span>, buf);
}
</code></pre>
<p>That was... <em>verbose</em>. I could just use <code>unwrap()</code> everywhere, but that would be handwaving and in poor taste. Sprinkling your code with <code>panic!</code> is not a sign of good style too. However, there are so many things that can go wrong during an HTTP request/response cycle! But there seems to be a pattern. Can we do better?</p>
<blockquote>
<p><a id="day5.rs" href="../../vol1/src/bin/day5.rs">day5.rs</a></p>
</blockquote>
<pre><code class="lang-rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">get_content</span></span>(url: &amp;<span class="hljs-keyword">str</span>) -&gt; hyper::<span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">String</span>&gt; {
    <span class="hljs-keyword">let</span> client = Client::new();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> response = client.get(url).send()?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buf = String::new();
    response.read_to_string(&amp;<span class="hljs-keyword">mut</span> buf)?;
    <span class="hljs-built_in">Ok</span>(buf)
}
</code></pre>
<blockquote>
<p><a id="day5.rs" href="../../vol1/src/bin/day5.rs">day5.rs</a></p>
</blockquote>
<pre><code class="lang-rust">

</code></pre>
<p>We refactored the request cycle into a separate function. But look how the code got simpler, thanks to the <a href="http://doc.rust-lang.org/std/result/#the-try!-macro" target="_blank">try! macro</a>. There&apos;s no explicit matching on the <code>Result</code> variants and the first <code>try!</code> that fails will return from the function with some kind of an HTTP error.</p>
<h2 id="post-and-query-parameters">POST and query parameters</h2>
<p>Sending POST requests with hyper is only a little bit more complicated. We&apos;ll write a wrapper function again, this time taking an additional argument of type <code>Query</code>.</p>
<blockquote>
<p><a id="day5.rs" href="../../vol1/src/bin/day5.rs">day5.rs</a></p>
</blockquote>
<pre><code class="lang-rust"><span class="hljs-keyword">type</span> <span class="hljs-title">Query</span>&lt;<span class="hljs-string">&apos;a</span>&gt; = <span class="hljs-built_in">Vec</span>&lt;(&amp;<span class="hljs-string">&apos;a</span> <span class="hljs-keyword">str</span>, &amp;<span class="hljs-string">&apos;a</span> <span class="hljs-keyword">str</span>)&gt;;

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">post_query</span></span>(url: &amp;<span class="hljs-keyword">str</span>, query: Query) -&gt; hyper::<span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">String</span>&gt; {
    <span class="hljs-keyword">let</span> client = Client::new();
    <span class="hljs-keyword">let</span> body = form_urlencoded::Serializer::new(String::new())
        .extend_pairs(query.iter())
        .finish();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> response = client.post(url).body(&amp;body[..]).send()?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buf = String::new();
    response.read_to_string(&amp;<span class="hljs-keyword">mut</span> buf)?;
</code></pre>
<blockquote>
<p><a id="day5.rs" href="../../vol1/src/bin/day5.rs">day5.rs</a></p>
</blockquote>
<pre><code class="lang-rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;24 days of Rust - hyper (day 5)&quot;</span>);
</code></pre>
<p>The main difference from <code>get_content()</code> is the serialization machinery coming from the <a href="https://crates.io/crates/url" target="_blank">url</a> crate. Once we&apos;ve built a raw request body (like <code>key=value&amp;foo=bar</code>), we pass it to the <code>body()</code> method and the rest is identical to the GET example above.</p>
<h2 id="sending-json">Sending JSON</h2>
<p>Our <code>post_query</code> function can be easily changed to borrow a struct, serialize it to JSON and send it over the wire.</p>
<blockquote>
<p><a id="day5.rs" href="../../vol1/src/bin/day5.rs">day5.rs</a></p>
</blockquote>
<pre><code class="lang-rust">}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">post_json</span></span>&lt;T&gt;(url: &amp;<span class="hljs-keyword">str</span>, payload: &amp;T) -&gt; hyper::<span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">String</span>&gt;
    <span class="hljs-keyword">where</span> T: Encodable
{
    <span class="hljs-keyword">let</span> client = Client::new();
    <span class="hljs-keyword">let</span> body = json::encode(payload).unwrap();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> response = client.post(url).body(&amp;body[..]).send()?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buf = String::new();
</code></pre>
<p>This function is generic in its <code>payload</code> argument, accepting anything that implements the <code>Encodable</code> trait. We can use the function as follows:</p>
<blockquote>
<p><a id="day5.rs" href="../../vol1/src/bin/day5.rs">day5.rs</a></p>
</blockquote>
<pre><code class="lang-rust"><span class="hljs-built_in">Ok</span>(buf)
}

<span class="hljs-preprocessor">#[derive(RustcDecodable, RustcEncodable)]</span>
<span class="hljs-keyword">struct</span> Movie {
    title: <span class="hljs-built_in">String</span>,
</code></pre>
<blockquote>
<p><a id="day5.rs" href="../../vol1/src/bin/day5.rs">day5.rs</a></p>
</blockquote>
<pre><code class="lang-rust"><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{:?}&quot;</span>, get_content(<span class="hljs-string">&quot;http://httpbin.org/status/200&quot;</span>));
    <span class="hljs-keyword">let</span> query = <span class="hljs-built_in">vec!</span>[(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>), (<span class="hljs-string">&quot;foo&quot;</span>, <span class="hljs-string">&quot;bar&quot;</span>)];
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{}&quot;</span>, post_query(<span class="hljs-string">&quot;http://httpbin.org/post&quot;</span>, query).unwrap());
    <span class="hljs-keyword">let</span> movie = Movie {
        title: <span class="hljs-string">&quot;You Only Live Twice&quot;</span>.to_string(),
        bad_guy: <span class="hljs-string">&quot;Blofeld&quot;</span>.to_string(),
</code></pre>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="https://github.com/servo/servo/wiki/HTTP-library-requirements" target="_blank">HTTP library requirements</a> from the Servo project</li>
<li><a href="https://github.com/jgillich/rust-request" target="_blank">rust-request</a> - a HTTP client library written on top of hyper</li>
<li><a href="https://github.com/gtolle/rest_client" target="_blank">rest_client</a> - another HTTP client built with hyper</li>
<li><a href="http://lucumr.pocoo.org/2014/11/6/error-handling-in-rust/" target="_blank">Improved error handling in Rust</a> by Armin Ronacher</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../book/vol1/day4.html" class="navigation navigation-prev " aria-label="Previous page: Day 4 - docopt"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../book/vol1/day6.html" class="navigation navigation-next " aria-label="Next page: Day 6 - working with JSON"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

    
    <script src="../../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"include-codeblock":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
