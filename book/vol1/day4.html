<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Day 4 - docopt | 24 days of Rust</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../../book/vol1/day5.html" />
    
    
    <link rel="prev" href="../../book/vol1/day3.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="1.4"
        data-chapter-title="Day 4 - docopt"
        data-filepath="book/vol1/day4.md"
        data-basepath="../.."
        data-revision="Sat Dec 31 2016 17:21:53 GMT+0000 (UTC)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="book/vol1/index.html">
            
                
                    <a href="../../book/vol1/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Volume 1
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="book/vol1/day1.html">
            
                
                    <a href="../../book/vol1/day1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Day 1 - Cargo and crates.io
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="book/vol1/day2.html">
            
                
                    <a href="../../book/vol1/day2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Day 2 - primal
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="book/vol1/day3.html">
            
                
                    <a href="../../book/vol1/day3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Day 3 - csv
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="book/vol1/day4.html">
            
                
                    <a href="../../book/vol1/day4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Day 4 - docopt
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="book/vol1/day5.html">
            
                
                    <a href="../../book/vol1/day5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Day 5 - hyper
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="book/vol1/day6.html">
            
                
                    <a href="../../book/vol1/day6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        Day 6 - working with JSON
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="book/vol1/day7.html">
            
                
                    <a href="../../book/vol1/day7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                        Day 7 - itertools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="book/vol1/day8.html">
            
                
                    <a href="../../book/vol1/day8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.8.</b>
                        
                        Day 8 - racer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="book/vol1/day9.html">
            
                
                    <a href="../../book/vol1/day9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.9.</b>
                        
                        Day 9 - anymap
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="book/vol1/day10.html">
            
                
                    <a href="../../book/vol1/day10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.10.</b>
                        
                        Day 10 - the glorious tau
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="book/vol1/day11.html">
            
                
                    <a href="../../book/vol1/day11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.11.</b>
                        
                        Day 11 - postgres
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="book/vol1/day12.html">
            
                
                    <a href="../../book/vol1/day12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.12.</b>
                        
                        Day 12 - image
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="book/vol1/day13.html">
            
                
                    <a href="../../book/vol1/day13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.13.</b>
                        
                        Day 13 - uuid
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="book/vol1/day14.html">
            
                
                    <a href="../../book/vol1/day14.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.14.</b>
                        
                        Day 14 - nalgebra
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="book/vol1/day15.html">
            
                
                    <a href="../../book/vol1/day15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.15.</b>
                        
                        Day 15 - FUSE filesystems, part 1
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="book/vol1/day16.html">
            
                
                    <a href="../../book/vol1/day16.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.16.</b>
                        
                        Day 16 - FUSE filesystems, part 2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="book/vol1/day17.html">
            
                
                    <a href="../../book/vol1/day17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.17.</b>
                        
                        Day 17 - from_fn
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="book/vol1/day18.html">
            
                
                    <a href="../../book/vol1/day18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.18.</b>
                        
                        Day 18 - redis
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="book/vol1/day19.html">
            
                
                    <a href="../../book/vol1/day19.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.19.</b>
                        
                        Day 19 - rusti
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="book/vol1/day20.html">
            
                
                    <a href="../../book/vol1/day20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.20.</b>
                        
                        Day 20 - zeromq
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="book/vol1/day21.html">
            
                
                    <a href="../../book/vol1/day21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.21.</b>
                        
                        Day 21 - rust-crypto
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="book/vol1/day22.html">
            
                
                    <a href="../../book/vol1/day22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.22.</b>
                        
                        Day 22 - built with Rust
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="book/vol1/day23.html">
            
                
                    <a href="../../book/vol1/day23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.23.</b>
                        
                        Day 23 - calling Rust from other languages
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="book/vol1/day24.html">
            
                
                    <a href="../../book/vol1/day24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.24.</b>
                        
                        Day 24 - conclusion
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="book/vol2/index.html">
            
                
                    <a href="../../book/vol2/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Volume 2
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="book/vol2/day1.html">
            
                
                    <a href="../../book/vol2/day1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Day 1 - cargo subcommands
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="book/vol2/day2.html">
            
                
                    <a href="../../book/vol2/day2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Day 2 - hound
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="book/vol2/day3.html">
            
                
                    <a href="../../book/vol2/day3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Day 3 - rayon
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="book/vol2/day4.html">
            
                
                    <a href="../../book/vol2/day4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Day 4 - structured logging
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="book/vol2/day5.html">
            
                
                    <a href="../../book/vol2/day5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        Day 5 - environment variables
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="book/vol2/day6.html">
            
                
                    <a href="../../book/vol2/day6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Day 6 - derive_builder
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="book/vol2/day7.html">
            
                
                    <a href="../../book/vol2/day7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        Day 7 - static initialization
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="book/vol2/day8.html">
            
                
                    <a href="../../book/vol2/day8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                        Day 8 - serde
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="book/vol2/day9.html">
            
                
                    <a href="../../book/vol2/day9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.9.</b>
                        
                        Day 9 - winreg
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="book/vol2/day10.html">
            
                
                    <a href="../../book/vol2/day10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.10.</b>
                        
                        Day 10 - nom, part 1
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="book/vol2/day11.html">
            
                
                    <a href="../../book/vol2/day11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.11.</b>
                        
                        Day 11 - nom, part 2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.12" data-path="book/vol2/day12.html">
            
                
                    <a href="../../book/vol2/day12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.12.</b>
                        
                        Day 12 - clap
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.13" data-path="book/vol2/day13.html">
            
                
                    <a href="../../book/vol2/day13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.13.</b>
                        
                        Day 13 - zip and lzma compression
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.14" data-path="book/vol2/day14.html">
            
                
                    <a href="../../book/vol2/day14.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.14.</b>
                        
                        Day 14 - Cursive
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.15" data-path="book/vol2/day15.html">
            
                
                    <a href="../../book/vol2/day15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.15.</b>
                        
                        Day 15 - tera
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.16" data-path="book/vol2/day16.html">
            
                
                    <a href="../../book/vol2/day16.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.16.</b>
                        
                        Day 16 - git2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.17" data-path="book/vol2/day17.html">
            
                
                    <a href="../../book/vol2/day17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.17.</b>
                        
                        Day 17 - diesel
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.18" data-path="book/vol2/day18.html">
            
                
                    <a href="../../book/vol2/day18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.18.</b>
                        
                        Day 18 - error_chain
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.19" data-path="book/vol2/day19.html">
            
                
                    <a href="../../book/vol2/day19.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.19.</b>
                        
                        Day 19 - leftpad
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.20" data-path="book/vol2/day20.html">
            
                
                    <a href="../../book/vol2/day20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.20.</b>
                        
                        Day 20 - reqwest
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.21" data-path="book/vol2/day21.html">
            
                
                    <a href="../../book/vol2/day21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.21.</b>
                        
                        Day 21 - app_dirs and preferences
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.22" data-path="book/vol2/day22.html">
            
                
                    <a href="../../book/vol2/day22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.22.</b>
                        
                        Day 22 - lettre
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.23" data-path="book/vol2/day23.html">
            
                
                    <a href="../../book/vol2/day23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.23.</b>
                        
                        Day 23 - built with Rust
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.24" data-path="book/vol2/day24.html">
            
                
                    <a href="../../book/vol2/day24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.24.</b>
                        
                        Day 24 - conclusion
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >24 days of Rust</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="day-4--docopt">Day 4 - docopt</h1>
<blockquote>
<p>Relevancy: 1.9 stable (macros only on nightly)</p>
</blockquote>
<p>One of the few chores when building a commandline program is argument parsing, so that <code>myprogram --config=myfile.conf --verbose -o output.txt</code> makes sense. Some arguments come in short and long variants, some are optional and some are positional only. There are a lot of libraries for argument parsing, some are even included in the respective languages&apos; distributions. In Rust&apos;s case there&apos;s the <a href="https://crates.io/crates/getopts" target="_blank">getopts crate</a>.</p>
<p>The first thing a moderately savvy user will do is... no, not read the documentation, but run <code>myprogram -h</code> (or <code>--help</code>) to discover available options. <code>getopts</code> and other libraries can derive such help summary for you, saving your time and reducing duplication. But what if it was the other way round? You&apos;d write the usage message, listing possible options, and the tool would build an argument parser from that. Enter <a href="http://docopt.org/" target="_blank">docopt</a>.</p>
<h2 id="what-is-docopt">What is docopt?</h2>
<p>The <strong>docopt</strong> initiative <a href="https://www.youtube.com/watch?v=pXhcPJK5cMc" target="_blank">originated in the Python community</a> in 2012 as an attempt to standardize common conventions for commandline arguments. The main idea is that the help message describes the interface of your program. Once you follow a few rules when writing that message, docopt can understand it and build an argument parser.</p>
<h2 id="docopt-for-rust">docopt for Rust</h2>
<p>We&apos;ll start by declaring a dependency in <code>Cargo.toml</code>:</p>
<pre><code class="lang-ini"><span class="hljs-title">[dependencies]</span>
<span class="hljs-setting">docopt = <span class="hljs-value"><span class="hljs-string">&quot;~0.6.78&quot;</span></span></span>
<span class="hljs-setting">docopt_macros = <span class="hljs-value"><span class="hljs-string">&quot;~0.6.80&quot;</span></span></span>
</code></pre>
<p>Cargo will now pull the <a href="https://crates.io/crates/docopt" target="_blank">docopt crate</a> along with the macros which are distributed separately.</p>
<p><strong>Note:</strong> The macros use a language feature (syntax extensions) that didn&apos;t stabilize in time before 1.0 release. Therefore at present the <code>docopt!</code> macro can be used only with the nightly versions of the compiler.</p>
<p>In our example application we&apos;ll try to mimic the <code>wc</code> tool for counting lines, words or characters in a file. Let&apos;s start with importing required libraries and writing the usage message:</p>
<pre><code class="lang-rust"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> rustc_serialize;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> docopt;

<span class="hljs-keyword">use</span> docopt::Docopt;

<span class="hljs-keyword">static</span> USAGE: &amp;<span class="hljs-string">&apos;static</span> <span class="hljs-keyword">str</span> = <span class="hljs-string">&quot;
Usage: wc [options] [&lt;file&gt;]

Options:
    -c, --bytes  print the byte counts
    -m, --chars  print the character counts
    -l, --lines  print the newline counts
    -w, --words  print the word counts
    -L, --max-line-length  print the length of the longest line
    -h, --help  display this help and exit
    -v, --version  output version information and exit
&quot;</span>;
</code></pre>
<p>Nothing fancy here, just a long string. See the <a href="http://docopt.org/" target="_blank">docopt specification</a> for the details of the format. We want to be able to decode the options into a struct, so it makes sense for the struct to implement the <code>Decodable</code> trait.</p>
<pre><code class="lang-rust"><span class="hljs-preprocessor">#[derive(RustcDecodable)]</span>
<span class="hljs-keyword">struct</span> Args {
    arg_file: <span class="hljs-built_in">Option</span>&lt;<span class="hljs-built_in">String</span>&gt;,
    flag_bytes: <span class="hljs-keyword">bool</span>,
    flag_chars: <span class="hljs-keyword">bool</span>,
    flag_lines: <span class="hljs-keyword">bool</span>,
    flag_words: <span class="hljs-keyword">bool</span>,
    flag_max_line_length: <span class="hljs-keyword">bool</span>,
}
</code></pre>
<p>The arguments must map to field names. Flags (toggle switches such as <code>-c</code> above) map to <code>flag_</code>-prefixed boolean fields, option arguments or meta-variables map to <code>arg_</code>-prefixed fields. If the argument is optional it can be represented by an <code>Option</code> value. But how do we actually turn the commandline args into a struct?</p>
<pre><code class="lang-rust"><span class="hljs-keyword">let</span> args: Args = Docopt::new(USAGE).and_then(|d| d.decode()).unwrap_or_else(|e| e.exit());
</code></pre>
<p>Now this is a dense line of code. Let&apos;s walk through it one step at a time.</p>
<pre><code class="lang-rust"><span class="hljs-keyword">let</span> docopt = <span class="hljs-keyword">match</span> Docopt::new(USAGE) {
    <span class="hljs-built_in">Ok</span>(d) =&gt; d,
    <span class="hljs-built_in">Err</span>(e) =&gt; e.exit(),
};
<span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{:?}&quot;</span>, docopt);
<span class="hljs-keyword">let</span> args: Args = <span class="hljs-keyword">match</span> docopt.decode() {
    <span class="hljs-built_in">Ok</span>(args) =&gt; args,
    <span class="hljs-built_in">Err</span>(e) =&gt; e.exit(),
};
</code></pre>
<p><code>Docopt::new()</code> returns a <code>Result&lt;Docopt, Error&gt;</code> value. The errors from docopt have a handy <code>exit()</code> method that prints the error message and quits the program. Printing a <code>Docopt</code> value gives us a lot of debugging information. The <code>decode()</code> method is responsible for creating our arguments object and we extract it from the <code>Ok</code> variant. We can now use <code>args</code> as any other struct in our program.</p>
<blockquote>
<p><a id="day4.rs" href="../../vol1/src/day4.rs">day4.rs</a></p>
</blockquote>
<pre><code class="lang-rust"><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Counting stuff in {}&quot;</span>, args.arg_file.unwrap_or(<span class="hljs-string">&quot;standard input&quot;</span>.to_string()));
    <span class="hljs-keyword">if</span> args.flag_bytes {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Counting bytes!&quot;</span>);
    }
    <span class="hljs-keyword">if</span> args.flag_chars {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Counting characters!&quot;</span>);
    }
</code></pre>
<h2 id="docoptmacros">docopt_macros</h2>
<p>But hey, didn&apos;t I tell you earlier about reducing duplication? In the example above there are two sources of information, namely the usage string and the <code>Args</code> struct. It&apos;s quite clear that these two represent the same concept, but you&apos;ll need to mantain two separate code pieces instead of one and that is prone to errors.</p>
<p><code>docopt!</code> to the rescue! This is a funny (for some value of fun, of course) macro that will generate the struct for us.</p>
<blockquote>
<p><a id="day4.rs" href="../../vol1/src/day4.rs">day4.rs</a></p>
</blockquote>
<pre><code class="lang-rust"><span class="hljs-preprocessor">#![feature(plugin)]</span>
<span class="hljs-preprocessor">#![plugin(docopt_macros)]</span>

<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> rustc_serialize;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> docopt;

docopt!(Args, <span class="hljs-string">&quot;
Usage: wc [options] [&lt;file&gt;]

Options:
    -c, --bytes  print the byte counts
    -m, --chars  print the character counts
    -l, --lines  print the newline counts
    -w, --words  print the word counts
    -L, --max-line-length  print the length of the longest line
    -h, --help  display this help and exit
    -v, --version  output version information and exit
&quot;</span>, arg_file: <span class="hljs-built_in">Option</span>&lt;<span class="hljs-built_in">String</span>&gt;);
</code></pre>
<p>The macro takes the name of the type to generate, usage string and (optionally) types for the generated fields. It also validates that the usage message conforms to the docopt spec. The validation happens at compile time when the <code>Args</code> struct is generated so there&apos;s no runtime overhead. But most importantly we now have a <strong>single</strong> piece of information to maintain instead of two.</p>
<p>There&apos;s one more advantage of the macro - our code inside <code>main()</code> can be simplified a bit. As the struct is generated from the usage message, we can get rid of one intermediate <code>Result</code> unwrapping; the struct has a static <code>docopt()</code> method which returns a <code>Docopt</code> value.</p>
<blockquote>
<p><a id="day4.rs" href="../../vol1/src/day4.rs">day4.rs</a></p>
</blockquote>
<pre><code class="lang-rust"><span class="hljs-keyword">let</span> docopt = Args::docopt();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;{:?}&quot;</span>, docopt);
    <span class="hljs-keyword">let</span> args: Args = docopt.decode().unwrap_or_else(|e| e.exit());
</code></pre>
<p>Docopt for Rust recently gained an ability to generate tab completion files for the shell (only bash at the moment). See the <a href="https://github.com/docopt/docopt.rs#tab-completion-support" target="_blank">readme</a> for more on that.</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="http://kblomqvist.github.io/2013/03/21/creating-beatiful-command-line-interfaces-for-embedded-systems-part1/" target="_blank">using docopt in C</a> for embedded systems</li>
<li>docopt implementations in various languages under the <a href="https://github.com/docopt" target="_blank">docopt organization on GitHub</a></li>
<li><a href="https://github.com/uutils/coreutils/blob/master/src/wc/wc.rs" target="_blank">wc in Rust</a> from the coreutils rewrite project</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../book/vol1/day3.html" class="navigation navigation-prev " aria-label="Previous page: Day 3 - csv"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../book/vol1/day5.html" class="navigation navigation-next " aria-label="Next page: Day 5 - hyper"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

    
    <script src="../../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"include-codeblock":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
